# shakheye avval----> /
# dakhele / che vojood darad?---------root, home/user1, home/user2, home/user3
# Home directory---$home-----/root barye root(user)-----/home/user1 home directory for user1-----/home/user2---home directory for user2

#                                   /
#                            root      home
#                                  user1  u2 u3 u4 u5

#    .   yani current Directory
#    ..   parrent dir
#    ~   Home Directory
#     / root directory
cd /root
cd /home/user1
cd /home/user2
cd /home/user3
#create tmp file and show it
echo "hallo"
#raftan be usere root
sodu su -
#liste mohtava:
ls
# liste mojooddar adrese felan:
ls /home/user1
#adresse alan kojas?
pwd
#ye pelle aghab:
cd ..
#pak kardane safhe:
clear
#tarikhe alan
date
#tarikh dar calender:
calender
#time ke server balas va chanta user darim:
uptime
#user jari:
whoami
#user , tarikh, ipPublic---ip carte shabake
who
#user ipPublic timeLogin tarigheye login:sshd:
w
#exit kardan va raftan be useri ke baoon login kardim
exit
#nemayeshe tamame userha be joz root:
users
#uid baraye user chie, gid yani groupId user jari chie
id
id root
id user1
#[root@ip-172-31-7-156 ~]   yani:  user jari root, id private session ine, ~ yani home directory baraye user, ke /root ya /home/user1 ya /home/user2, ....
# manual baraye command who
man who
#list kardan
ls
#list ba hidden ha: moshahede ba joziate previllage va valume, long list
ls -l
ll


#cat kardan yani khandane yek file va nemayesh haminja, hamasho
cat file1
cat /root/original-ks.cfg
#hameye file ro neshoon nemide va ba SPACE mishe raft safheye baad: ba q ham mishe kharej shod, page by page
less /root/original-ks.cfg
(SPACE)
q
#more, dar sadi neshoon mide
more file1
#10 khatte avval
head file1
#10 khatte akhar
tail file1
#20 khatte avval
head -20 file1
#20 khatte akhar
tail -20 file1


#create file va kamelan khali
touch file1
#create file age mojood nabashe va hamoonja mige mohtaviat ham bede, edit nemishe kard, age file mojood bashe overwrite mishe
cat > file1
#jahate khorooj, (ctrl)+c
#age file nabashe dorostesh mikone age bashe append mikone be tahesh
cat >> file1
#neshoon mide file jari ro
cat file1


#create file va mire too narmafzare vi ke mishe toosh nevesht va update kard, 
vi file1
#(ESC) : wq (Enter) #khorooj
#list
ls
#list long
ls -l
#list long timestamp, who is recently updatet 
ls -l -t
#list long timestamp reverse
ls -l -t -r
ls -ltr
pwd
clear
#install nano, y yani are az in package mojood estefade kon
yum install nano -y-------------ubuntu: apt install nano -y
#nano mesle notepad
nano file1
#(ctrl)+o #save kardan
#(ctrl)+x #khorooj
# create file: 
touch file1, cat > file1, vi file1, nano file1
# read file: 
cat file, vi file1, nano file1
#update file:
vi file1, nano file1
#create directory
mkdir dir1
mkdir dir1 dir2 dir3
#
ls , directory ha ra rangi midahad
ls -l
ll -------directory ba d shoroo mishe vali file ha ba -
ls -ld ---------list long directory faghat
#list long all,even hidden file
ls -la
#change directory
cd dir1
cd ..
cd /home/user1
#go to home directory
cd ~ 
#delete file
rm file1
rm file1 file2
rm -f file1   # force without asking
#rmdir nemitoone delete kone age por bashe toosh
rmdir dir1 dir2 dir3
rm -f -r dir1 ------force,recursive yani be soorate bargashti hame too ha ham pak kon
rm -rf dir1
#besyar khatarnak choon har chi pak she kamelan pak miashe, * yani hameye dir ha va file ha
rm -rf *
#tree yek app baraye directory ha
yum install tree -y
#derakhte data az jaii ke hastim:
tree
#copy file, cp sourcefile targetfile, age file2 mojood nabashe misaze oono, copy existedfile to existedfile : copy content
cp file1 file2
#copy file to directory, doros mikone file ra
cp file1 dir1/dir2
#copy dir to dir, content ra az dir1 mirize too dir2, -r yani recursive yani emal shavad rooye contente dakheli
cp -r dir1 dir2
#move ya cut, file to dir
mv file1 dir2
#rename file
mv file1 file2
#go to parrent dir
cd ..
cd tmp
cd /root/dir
cd /    ----starting point
#find kon dar hameye name haye file ha va dir ha dakhele / address, mesle windows------serch mitoone bar asase user bashe
find / -name file1name
find / -user user1     -------  file haye user1 ra peida kon, user1 owner bashe
find / -group group1    ------ group1 owner bashe
#diff mesle git, khat haye motafaveto mide, 2c2 yani khatte 2 az file avval moatafavete az khatte 2 az file 2
diff file1 file2
#tashkhise file ya dir
ll ------charactere avval: -: file   d:Directory  l: link yani shortcut
file file1
file dir1 -------- link, block, charachter
# grep mire too file va content, search dakheli*********************mohem****************************
grep felan file1 
grep -n felan file1  -------ba shomare khat

#----------------------------------------------------------as a script var/ftp-------------ex
x1 = $(grep -m 1 felan file1.txt)
echo "$x1"


grep felan file1.txt | head -n 1-----avvalin ro bede
#i , ignore case 
grep -i felan file1
# grep faghat baraye file as, estefade az PIPE, khat haii ro grep kon ke felan toosh bashe 
ls -l | grep felan
# list kon faghar onnayii ke ba d shoroo mishe, khat haii ke
ls -l | grep ^d
grep ^t file1
#stream transfer, SED, stream editor
sed 's/oldText/newText/' file1  -------- replace micone va hatman bayad einan khalame ro bebine
sed 's/oldText/newText/g' file1  ----------/g  yani too joone ye kalame dige ham bashe ghaboole
sed 's/oldText/newText/ig' file1 ---------global mesle ghabli va ignore kone Case
sed -i 's/oldText/newText/' file1 ----------akharesh update ham mikone
sed -n '5,10p' file1    ----khattte 5 ta 10 ro neshoon mide, mesle tail va head
sed 's/#/ /' file1 --------# ha hazf shavad
sed '5,10d' file1       -------khate 5 ta 10 ro delete mikone

sort faramoosh shod????????


-----------------------------------USER
#change user to root
sudo su -
#kharej shodan az root
exit
#super User --------home dir: /root -------------shell: /bin/bash
#, System User -------------home dir:  /var/ftp-------------ex: apache,ftp,ssh ---------------shell: /sbim/nologin
#Normal User--------------home Directory: /home/user1------------------shell:/bin/bash
whoami
id
id root
#all users in list:
cat /etc/passwd
#vaghti user doros mishe:
#1: ye home dir doros mishe /home/newuser----------2: UID,GID are given---------3: ezafe mishe be /etc/passwd
useradd user1
id user1
id
usermod -G group1 user1--------user user1 ezafe shod be group1
#mitavan userid, groupId, primaryId, homeDirectory, comment, shell dir ro taiin kard,......useradd -s user1....test nashode,
#useradd -u user1
#useradd -G user1
#useradd -g user1
#useradd -d user1
#useradd -c user1
#useradd -s user1
#login ba user1, avval taiine password
passwd user1

#password gom mishe>dar bala amadane Ubunto mizanim "SHIFT" mirim be mohit Recover>drop to shell> inja mizanim:
passwd root--------va hala passe jadid

#config for AWS:
nano /etc/ssh/sshd_config
#passwordauthentication no  => passwordauthentication yes
#save, exit
service sshd reload

cd ~
pwd
#-rwxrwxrwx 1 user1 user1 file1: - yani file ast, rwx yani owner in file ejaze read,write,execute darad, agar file shell bashad mitavanad ejra shavad va ye seri command ha ra ejra konad
#- yani file, d yani dir, c yani character file mesle mouse va keyboard, b yani block mesle hard disk, l yani softlink yani shortcut
#rwx avval baraye owner, dovvom baraye bachehaye Group va sevvom baraye baghie, root ham hame ro dare albate
# 1 yani in file  , 2 directory
# read bara dir yani too ls miad, write yani mishe add/del/rename kard, execute yani mishe cd kard
# owner yani ba che useri sakhte shode

#change permission:
chmod u+x file1
#u yani user yani owner, u+x yani be permission owner execute ezafe beshe
#g yani group yani groupe owner, yani be permission write remove shavad
#o yani other permission, o=r o=rw o=rwx yani overwrite kardan
chmod u+x,g-w,o=r file1
#-rw-rw-rw-
chmod 666 file1
#-rwxr-xr-x
chmod 755 file1
#-rwxrwxrwx
chmode 777 file1
#root hame ra baz mikonad, vali baghie tabee permission hastand
#-rw-r--r--
chmod 644 file1
ls -ld
#drwx--x---   yani ejaze cd shodan be ham groohi ha dade shode
#in moghei mohem tar ast ke man mikham be baghie user ha dasresi bedam be chizaye khodam
#age be dir dastresi bedim mani ino nadare ke be content oon ham permission dadim
chmod 710 /home/john/ --------user digar dar group mitoone cd kone
chmod 750 /home/john/ --------user digar dar group mitoone ls kone
chmod 770 /home/john/ --------user digar dar group mitoone file jadid dir jadi doros kone hazf kone,rename kone
#chmod ra faghad owner ya root mitoonan bokonen
#change owner chown, faghat tavassote root hatta owner ham nemitoone:
chown user2:user2 file1
#faghat owner avaz shavad
chown user2 file1
#file---dir---link---block file(hard disk)----charachter file(mouse)
file file1
file dir
file link1


-----------------------------------------------------System--cpu/ram/memory/OS
#restart:
reboot
#list of history command as root user
history
#har user ye file .bash_history dare ke command ha oonja zakhire mishe
history
#list long all,even hidden file
#hidden file with .: .bash_history
ls -la
#status of memory:
free
#memory information:
cat /proc/meminfo
#cpu info
cat /proc/cpuinfo
#kernel info: kernel chie linux unix , ip chie
uname -a
#os info, os version
cat /etc/redhat_release
#fazaye masrafi har file
du     ------------hajm be kilo
du -m ----------hajm be mega
du -m /etc
man du
du -k  -----------be kilo, KB
#po karbord, show most occupied top 10  , based on most occupied, dar redhat kar nemikone
du -k /cat | sort -rn head
#dastoore ls koja zakhire shode, file gz kojas?
whereis ls
#alias chi boode ls,va file gz an kojas
which ls
#file system, masalan cDrive DDrive, liste file system ha va hajmeshoon:
df ---------------based on KB
df -m -------------based on MB


---------------------------------------------------------software
#install just for root-user-------install for everyone
sudo apt install net-tools     ---------for ipconfig
yum install tree -y       -------tree chart is given
yum install nano -y       -----nano like notpad
yum install gzip -y       ---gz mikone, hajme kamtar
yum install zip -y           ----zip file....mesle gzip
yum install telnet -y    ---chizi mesle ssh
yum install wget -y       ----download packages
yum install httpd -y        -----yek webservice ke mishe toosh http gozasht
yum remove tree 
sudo apt install openssh-server -y

yum update tree
#info of packege
yum info tree
#all packages
yum list installed
yum list installed | grep wget
yum list installed | grep telnet
#hameye package haye mojood dar repository are listed out:
yum list avalable | grep tree






----------------------------------------------------------Network
#name of server, name of host:
hostname
#local ip:
hostname -i
ip a
#rahe sevvom :instal net-tools
sudo apt install net-tools
ifconfig
#-----------------------------------------------get public Ip
curl ifconfig.me
#-----------------------ssh
sudo apt update
sudo apt install openssh-server -y
sudo systemctl status ssh-------if ssh is up & running should be  "active(running)"
sudo ss -tlnp | grep :22-----we want to see if SSH listen to port 22
nano /etc/ssh/ssh_config---------port 22 comment nabashad
systemctl ssh restart
ssh localhost--------ettesale dakheli
ping 10.0.1.5--------------------------------age in javab nade moshkel ssh nis moshkel networkeee
#active in boot:
sudo systemctl enable ssh


cat /etc/hostname
#rename difinitely hostname and it need reload..........baraye DNS moragheb bashim
vi /etc/hostname
init 6           -----reboot
#rename temprary:
hostname newname
#[usr1@hostname1 addr-current]
#aya host google.com dar dastres ast
#dastresi be hostname haye digaran, aya host balas ya na,up and running
ping google.com
ping (ip)

#download tomacat, site tomcat, file tar.gz, copy link address
#mamoolan file tar.gz ast
wget (link address.tar.gz)
#koja zakhire mishe? too homeDirectory

#identify ip address, private ip address
ifconfig
ip addr

#access as a browser
#practical for test app
curl google.com

#Ip public.....ip from network-cart-------internet
#ip private ....inside ip
#ip for app -----> port
#dar vaghe har barname ye port az host ra barmidarad----har service
#vaghti migim in IP:port, eshare be barname ast ke age webserver bashad va darkhastdahande browser bashad be ma site ra neshan midahad---html pas midahad
#http:80, ssh:22, telnet:23, ftp:21, DNS:53, https:443, smtp:25

#which ports are used and an which app
netstat -tulpn
#check particulare port
telnet localhost 80
telnet 1.2.6.2 22

----------------------------------------------------------------service
#hameye application Server ha va dar vaghe barnamehaye web service hastand
#whaever that are listennig
yum install httpd -y


service httpd status
service httpd start
service httpd status
#ubuntu
sudo apt update
sudo apt install apache2 -y---------------------------ubuntu
sudo systemctl start apache2
sudo systemctl enable apache2
#check port
natstad -tulpn
telnet localhost 80
telnet (ip public) 80
#check httpd in internet: IPPUBLIC:80, dar AWS bayad security group inbound tarif kard
service microservice1 status
service microservice1 start
service microservice1 stop
service microservice1 reload
service microservice1 restart

#service dar Startup ejra shavad, mesle ssh
#webserver ha bayad dar Startup bian hatman
chkconfig --list
chkconfig microservice1 on
chkconfig microservice1 off

#port ssh:22, daemon : sshd, confFile:/etc/ssh/sshd_config
#port hhtp:80,daemon : httpd, configfile: / etc/httpd/conf/httpd.conf
#daemon yani in service ro ba chi seda bezanim

#create new html fiel
cd /var/www/html
vi index.html
#start stop by root-user
#change index.html
service httpd status
service httpd restart
service httpd stop
service httpd start

systemctl stop httpd
systemctl status httpd
systemctl start httpd
#on browser we can call ipPublic....default:index.html and 80
# firewall ya security Group bayad baraye in port baz bashad*****************************************
#restart host:
init 6
#add to startup
chkconfig httpd on     ------as root-user
chkconfig httpd off    ------as root-user



----------------------------------------------------browser

curl ip:port
----------------------------------------------------process
#program, shell script, listener nadarad
#as background or vorground

#list of process:  same as task manager
#pid: process ID, ppid: parent process Id
ps -ef
ps -ef | grep httpd
ps -ef | grep ssh
#kill process:
#har service yek process ham hast, age service kill nashod miche process oon ro kill kard
service httpd status     ---------PID inja dide mishavad
kill 1665
#har user ham yek process ast, va ba kill an session user1 ghat mishe
#in root user:
ps -ef | grep user1    ---------get process id
kill -9 1658    -----minus yani force kill

#sleep process:
sleep 10    -----vorground
sleep 10 &       ------background process
(ctrl+z)     ----tamam kardane process

#liste job ha:
jobs
bg 1% ----yani job haye background shomareye 1 ra dobare ejra kon dar bg
bg 2%
fg 1%      ------job 1 ra dar halate fg ejra kon----hame chi ghofl mishavad

#top process
top

-----------------------------------------------------------Archive, folder file
#gzip,gunzip baraye file ast va hajm ra ham kam mikonad, zip mikone
#tar baraye folder ast, extract mikone
#usually at first tar then gzip
yum install gzip -y
gzip file1 -----------kaheshe hajm
gunzip file1

yum install zip -y      ----same gzip
zip file1.zip file1      -------src:file1    des : file1.zip
unzip file1.zip

#directory:
tar -cvf dir1.tar dir1 -----------des: dir1.tar   src:dir1-----type dir1.tar file ast
tar -xvf dir1.tar      -----unextract kardan

#baz kardane tomcat.tar.gz:
gunzip filetomcat.tar.gz
tar -xvf file1name
#rahe behtar:
tar -xvzf tomcat.tar.gz


-------------------------------------------------------------crontab----job schedule
#create schedule job
30 8 * * * command----------saate 8:30 dar har rooz
00 14 * * 6 comand ---------saat 14:00 every saterday
00 00 01 06 * command ------saat 00:00 1 omin rooze july
30 15 25 * * comand-----15:30 25th har mah har rooz hafte
min hour chandomin-rooze-mah chandomin-mahe-sal chandomin-rooze-hafte

#baraye hameye user ha
#list of cronjob:
crontab -l
crontab -e 
#file baz mishe
30 08 * * * echo "1" >> /tmp/file1
30 15 25 * * echo "3" >> /tmp/file2
cronjob -l -----------2 ta ra dar list neshoon mide
#file ra doros mikone va tosh 1 ra append mikone,age ham file bashe be an append mikone
* * * * * echo "3" >> /tmp/file3-----------har daghighe
#bejaye echo "1" >> /tmp/file1 yek shellScript gharar migire



-----------------------------------------------------------soft link, hard link
#soft link daghighan shortcut ast, age orginal-file pak she inam kar nemikone,age org update beshe inam update ro neshoon mide
#hard link backup file ast, agar orginal pak shok in pak nemishe,age org update she inam update mishe
ln -s file1 link1
cat file1
cat link1
rm file1
cat link1----kar nemikone

ln file1 backup1
cat file1 
cat backup1
rm file
cat backup1 ----kar mikone

vi hello.sh
#dakhele shell : echo "hello world"
cat hello.sh---------------hello.sh bayad permission execute dashte bashe
#execute shell comand: agar dar directory dorost bashimn
./hello.sh--------in currnt dir we have this file and want to execute
#shell ha bayad beravad dar *****************************************execute-directory*****************************yani: /usr/local/bin***********
#which hello.sh ------yani boro tooye execute directory hello.sh ra peida kon va ejra kon
#/usr/local/bin
#az hello.sh dar exe-dir yek soft link misazim,best practice+++++++++++++script haye ma mamollan ye jaye khassan masalan az GIT, Softlink misazim va dar bin migozarim
ln -s /root/hello.sh /usr/local/bin/hello***************importantttt
ls -l /usr/local/bin-------soft link injas
hello-------kar mikone
which hello-----------/usr/local/bin/hello midahad
#dar vaghe mesle cat, ls, ... ma ham yek shell darim be name hello











-------------------------------------------------------------------copy windows to linux and vice versa
#ba MobaXtrem va winscp, drag drop
-------------------------------------------------------------------copy file/dir host1 to host2,push, pull
#copy az hoste jari be jaii:
scp sourcefile1 user1@des_host:des_folder---------pass user des ra mikhad, ipPublic or ipprivate
#password base Authentication bayad faal shavad baraye user user1
scp file1 user1@10.23.32.43:/tmp
#copy az jaii be hoste jari:
scp user1@10.23.32.43:/tmp/file1 /home/user1/
#push dir:
scp -r dir1 user1@10.23.32.43:/tmp----- -r yani recursive yani in amal baraye file haye dakheli ham anjam she












------------------------------------------------------------------SSh to other host
#dar host ma automat ssh nasb shode(in amazon linux), ssh public key darad va private key
#public key ghofl ast ke makhsoose private key ast, 
#publickey: ghofl
#private key klid as ke be har ki khastim midim(pem file avvalie)
#dar AWS ye host doros mikonim, automat ghof-ssh toosh gozashte mishe va klidesh pem-file be ma midan
#ssh ba mobaXtrem va putty ham ba privateKey mishe ham ba user-pass
#vali host ha ba ham ssh bezanim faghat ba private-public-key mishe
#be ooni ke mikhaym vasl shim ghofle khodemono mindazim toosh
#kholase bayad ghofle khodemoon ya public-key khodemoono bendazim too har ki mikhay vasl shim
#id_rsa: private, id_rsa.pub mishe public, ke midimesh be har ki mikhaym vasl shim
#hatman bayad name ghofl ra avaz konim be: $home/.ssh/authorized_keys
#$home/.ssh/authorized_keys

ssh-keygen----------address ra midahad ke PK va PrivateKey kojas------key haye jadid doros mikone
/root/.ssh/
cat id_rsa------------------------bayad jaye amn negahdari shavad(id_rsa = pem file)
cat id_rsa.pub
#mirim to target host va foldere .ssh misazim, va file authorized_keys
mkdir .ssh-----dar server target
vi authorized_keys--------permision baraye user bayad dade shavad----dar server target
ssh-copy-id 172.168.2.5-----------copy mikone dar jaye doros-----user default root migire choon inja ham root hastim-----pass mikhad
#hatta khodash .ssh ra ham misazad va rename ham mikonad
#ba dastoore ssh-copy-id 172.168.2.5 hame kar anjam mishe, faghat user yeki bashe

#ettesal:
ssh -i (adress privateKey) user1@(ip) 
ssh -i /root/.ssh/id_rsa root@178.54.54.1
ssh 178.54.54.1
#vasl shodim be digari

#id_rsa bayad dar addresse in /root/.ssh bashad masalat dar /opt, hatta age berim too foldere /opt baz kar nemikone
ssh -i /root/.ssh/id_rsa root@178.54.54.1----ba -i mishe addrese key ro avaz kard
ssh-keygen -t rsa -b 4096--------amn tar mide key ha ro
mv id_rsa valaxykey-------rename ham mishe kard

#as a other user:
ssh user1@157.5.5.8 ------
copy id_rsa va dasti sakhte .ssh va sakhte autorized_key va paste dar servere3
#move kardane addi public key: copy and paste
#default dar host dar .ssh ye ghofl hast ke ba pem baz mishavad baraye ec2_user
#dar /home/ec2_user/.ssh/authorized_key...ghofle automat
#mitoonim be user1 ham in public key ra bedim
mv valaxy_key /root/.ssh
#age 50 ta target-host dashte bashim ba copy va rename faghat hamin be hame mishe vasl shod

#berim too server 2 va in file ro oonja :
ssh -i /root/.ssh/id_rsa root@178.54.54.1 'bash -s' < script.sh
